<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A guard that enables protected loads of concurrent objects."><title>Guard in papaya - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../static.files/rustdoc-1a91846b.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="papaya" data-themes="" data-resource-suffix="" data-rustdoc-version="1.88.0 (6b00bc388 2025-06-23)" data-channel="1.88.0" data-search-js="search-f7877310.js" data-settings-js="settings-5514c975.js" ><script src="../static.files/storage-4e99c027.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-7ef8a74a.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-893ab5e7.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-6580c154.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-044be391.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../papaya/index.html">papaya</a><span class="version">0.2.3</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Guard</a></h2><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.collector" title="collector">collector</a></li><li><a href="#tymethod.defer_retire" title="defer_retire">defer_retire</a></li><li><a href="#tymethod.flush" title="flush">flush</a></li><li><a href="#tymethod.refresh" title="refresh">refresh</a></li><li><a href="#tymethod.thread_id" title="thread_id">thread_id</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.compare_exchange" title="compare_exchange">compare_exchange</a></li><li><a href="#method.compare_exchange_weak" title="compare_exchange_weak">compare_exchange_weak</a></li><li><a href="#method.protect" title="protect">protect</a></li><li><a href="#method.swap" title="swap">swap</a></li></ul><h3><a href="#dyn-compatibility">Dyn Compatibility</a></h3><h3><a href="#implementors">Implementors</a></h3></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="index.html">In crate papaya</a></h2></div></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="index.html">papaya</a></div><h1>Trait <span class="trait">Guard</span><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../src/seize/guard.rs.html#13">Source</a> </span></div><pre class="rust item-decl"><code>pub trait Guard {
    // Required methods
    fn <a href="#tymethod.refresh" class="fn">refresh</a>(&amp;mut self);
<span class="item-spacer"></span>    fn <a href="#tymethod.flush" class="fn">flush</a>(&amp;self);
<span class="item-spacer"></span>    fn <a href="#tymethod.collector" class="fn">collector</a>(&amp;self) -&gt; &amp;<a class="struct" href="../seize/collector/struct.Collector.html" title="struct seize::collector::Collector">Collector</a>;
<span class="item-spacer"></span>    fn <a href="#tymethod.thread_id" class="fn">thread_id</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.usize.html">usize</a>;
<span class="item-spacer"></span>    unsafe fn <a href="#tymethod.defer_retire" class="fn">defer_retire</a>&lt;T&gt;(
        &amp;self,
        ptr: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
        reclaim: unsafe <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.fn.html">fn</a>(<a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, &amp;<a class="struct" href="../seize/collector/struct.Collector.html" title="struct seize::collector::Collector">Collector</a>),
    );

    // Provided methods
    fn <a href="#method.protect" class="fn">protect</a>&lt;T&gt;(&amp;self, ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;, order: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.swap" class="fn">swap</a>&lt;T&gt;(
        &amp;self,
        ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;,
        value: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
        order: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
    ) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.compare_exchange" class="fn">compare_exchange</a>&lt;T&gt;(
        &amp;self,
        ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;,
        current: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
        new: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
        success: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
        failure: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.compare_exchange_weak" class="fn">compare_exchange_weak</a>&lt;T&gt;(
        &amp;self,
        ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;,
        current: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
        new: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
        success: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
        failure: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>&gt; { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A guard that enables protected loads of concurrent objects.</p>
<p>This trait provides common functionality implemented by <a href="struct.LocalGuard.html" title="struct papaya::LocalGuard"><code>LocalGuard</code></a> and
<a href="struct.OwnedGuard.html" title="struct papaya::OwnedGuard"><code>OwnedGuard</code></a>. See <a href="../seize/guide/index.html#starting-operations" title="mod seize::guide">the guide</a> for an
introduction to using guards.</p>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.refresh" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#27">Source</a><h4 class="code-header">fn <a href="#tymethod.refresh" class="fn">refresh</a>(&amp;mut self)</h4></section></summary><div class="docblock"><p>Refreshes the guard.</p>
<p>Calling this method is similar to dropping and immediately creating a
new guard. The current thread remains active, but any pointers that
were previously protected may be reclaimed.</p>
<h5 id="safety"><a class="doc-anchor" href="#safety">§</a>Safety</h5>
<p>This method is not marked as <code>unsafe</code>, but will affect the validity of
pointers loaded using <a href="trait.Guard.html#method.protect" title="method papaya::Guard::protect"><code>Guard::protect</code></a>, similar to dropping a guard.
It is intended to be used safely by users of concurrent data structures,
as references will be tied to the guard and this method takes <code>&amp;mut self</code>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.flush" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#39">Source</a><h4 class="code-header">fn <a href="#tymethod.flush" class="fn">flush</a>(&amp;self)</h4></section></summary><div class="docblock"><p>Flush any retired values in the local batch.</p>
<p>This method flushes any values from the current thread’s local batch,
starting the reclamation process. Note that no memory can be
reclaimed while this guard is active, but calling <code>flush</code> may allow
memory to be reclaimed more quickly after the guard is dropped.</p>
<p>Note that the batch must contain at least as many objects as the number
of currently active threads for a flush to be performed. See
<a href="../seize/collector/struct.Collector.html#method.batch_size" title="method seize::collector::Collector::batch_size"><code>Collector::batch_size</code></a> for details about batch sizes.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.collector" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#42">Source</a><h4 class="code-header">fn <a href="#tymethod.collector" class="fn">collector</a>(&amp;self) -&gt; &amp;<a class="struct" href="../seize/collector/struct.Collector.html" title="struct seize::collector::Collector">Collector</a></h4></section></summary><div class="docblock"><p>Returns the collector this guard was created from.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.thread_id" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#50">Source</a><h4 class="code-header">fn <a href="#tymethod.thread_id" class="fn">thread_id</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.usize.html">usize</a></h4></section></summary><div class="docblock"><p>Returns a numeric identifier for the current thread.</p>
<p>Guards rely on thread-local state, including thread IDs. This method is
a cheap way to get an identifier for the current thread without TLS
overhead. Note that thread IDs may be reused, so the value returned
is only unique for the lifetime of this thread.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.defer_retire" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#133">Source</a><h4 class="code-header">unsafe fn <a href="#tymethod.defer_retire" class="fn">defer_retire</a>&lt;T&gt;(
    &amp;self,
    ptr: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
    reclaim: unsafe <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.fn.html">fn</a>(<a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, &amp;<a class="struct" href="../seize/collector/struct.Collector.html" title="struct seize::collector::Collector">Collector</a>),
)</h4></section></summary><div class="docblock"><p>Retires a value, running <code>reclaim</code> when no threads hold a reference to
it.</p>
<p>This method delays reclamation until the guard is dropped, as opposed to
<a href="../seize/collector/struct.Collector.html#method.retire" title="method seize::collector::Collector::retire"><code>Collector::retire</code></a>, which may reclaim objects immediately.</p>
<h5 id="safety-1"><a class="doc-anchor" href="#safety-1">§</a>Safety</h5>
<p>The retired pointer must no longer be accessible to any thread that
enters after it is removed. Additionally, the pointer must be valid
to pass to the provided reclaimer, once it is safe to reclaim.</p>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.protect" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#64">Source</a><h4 class="code-header">fn <a href="#method.protect" class="fn">protect</a>&lt;T&gt;(&amp;self, ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;, order: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a></h4></section></summary><div class="docblock"><p>Protects the load of an atomic pointer.</p>
<p>Any valid pointer loaded through a guard using the <code>protect</code> method is
guaranteed to stay valid until the guard is dropped, or the object
is retired by the current thread. Importantly, if another thread
retires this object, it will not be reclaimed for the lifetime of
this guard.</p>
<p>Note that the lifetime of a guarded pointer is logically tied to that of
the guard — when the guard is dropped the pointer is invalidated. Data
structures that return shared references to values should ensure that
the lifetime of the reference is tied to the lifetime of a guard.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.swap" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#73">Source</a><h4 class="code-header">fn <a href="#method.swap" class="fn">swap</a>&lt;T&gt;(&amp;self, ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;, value: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, order: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a></h4></section></summary><div class="docblock"><p>Stores a value into the pointer, returning the protected previous value.</p>
<p>This method is equivalent to <a href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html#method.swap" title="method core::sync::atomic::AtomicPtr::swap"><code>AtomicPtr::swap</code></a>, except the returned
value is guaranteed to be protected with the same guarantees as
<a href="trait.Guard.html#method.protect" title="method papaya::Guard::protect"><code>Guard::protect</code></a>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.compare_exchange" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#83-90">Source</a><h4 class="code-header">fn <a href="#method.compare_exchange" class="fn">compare_exchange</a>&lt;T&gt;(
    &amp;self,
    ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;,
    current: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
    new: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
    success: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
    failure: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>&gt;</h4></section></summary><div class="docblock"><p>Stores a value into the pointer if the current value is the same as the
<code>current</code> value, returning the protected previous value.</p>
<p>This method is equivalent to <a href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html#method.compare_exchange" title="method core::sync::atomic::AtomicPtr::compare_exchange"><code>AtomicPtr::compare_exchange</code></a>, except the
returned value is guaranteed to be protected with the same
guarantees as <a href="trait.Guard.html#method.protect" title="method papaya::Guard::protect"><code>Guard::protect</code></a>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.compare_exchange_weak" class="method"><a class="src rightside" href="../src/seize/guard.rs.html#105-112">Source</a><h4 class="code-header">fn <a href="#method.compare_exchange_weak" class="fn">compare_exchange_weak</a>&lt;T&gt;(
    &amp;self,
    ptr: &amp;<a class="struct" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html" title="struct core::sync::atomic::AtomicPtr">AtomicPtr</a>&lt;T&gt;,
    current: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
    new: <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>,
    success: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
    failure: <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/enum.Ordering.html" title="enum core::sync::atomic::Ordering">Ordering</a>,
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.88.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>, <a class="primitive" href="https://doc.rust-lang.org/1.88.0/std/primitive.pointer.html">*mut T</a>&gt;</h4></section></summary><div class="docblock"><p>Stores a value into the pointer if the current value is the same as the
<code>current</code> value, returning the protected previous value.</p>
<p>This method is equivalent to <a href="https://doc.rust-lang.org/1.88.0/core/sync/atomic/struct.AtomicPtr.html#method.compare_exchange_weak" title="method core::sync::atomic::AtomicPtr::compare_exchange_weak"><code>AtomicPtr::compare_exchange_weak</code></a>,
except the returned value is guaranteed to be protected with the
same guarantees as <a href="trait.Guard.html#method.protect" title="method papaya::Guard::protect"><code>Guard::protect</code></a>.</p>
</div></details></div><h2 id="dyn-compatibility" class="section-header">Dyn Compatibility<a href="#dyn-compatibility" class="anchor">§</a></h2><div class="dyn-compatibility-info"><p>This trait is <b>not</b> <a href="https://doc.rust-lang.org/1.88.0/reference/items/traits.html#dyn-compatibility">dyn compatible</a>.</p><p><i>In older versions of Rust, dyn compatibility was called "object safety", so this trait is not object safe.</i></p></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-Guard-for-LocalGuard%3C'_%3E" class="impl"><a class="src rightside" href="../src/seize/guard.rs.html#187">Source</a><a href="#impl-Guard-for-LocalGuard%3C'_%3E" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Guard.html" title="trait papaya::Guard">Guard</a> for <a class="struct" href="struct.LocalGuard.html" title="struct papaya::LocalGuard">LocalGuard</a>&lt;'_&gt;</h3></section><section id="impl-Guard-for-OwnedGuard%3C'_%3E" class="impl"><a class="src rightside" href="../src/seize/guard.rs.html#308">Source</a><a href="#impl-Guard-for-OwnedGuard%3C'_%3E" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Guard.html" title="trait papaya::Guard">Guard</a> for <a class="struct" href="struct.OwnedGuard.html" title="struct papaya::OwnedGuard">OwnedGuard</a>&lt;'_&gt;</h3></section></div><script src="../trait.impl/seize/guard/trait.Guard.js" data-ignore-extern-crates="seize" async></script></section></div></main></body></html>